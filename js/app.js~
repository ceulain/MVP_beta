var app = angular.module('mvp', ['firebase']);

app.constant('FIREBASE_URI', 'https://boos.firebaseio.com/');

app.controller('SecondCtrl', function (PlayerService){
    
    var snd = this;
    
    snd.players = PlayerService.getPlayers();
    snd.stat = PlayerService.getCurrentStat();
    console.log(snd.players);
    snd.selectStat = function (currentPlayer) {
	console.log(snd.stat);
	if( PlayerService.getCurrentStat() === "but"){
	    currentPlayer.but = parseInt(currentPlayer.but, 10) + 1;
	}else if( PlayerService.getCurrentStat() === "passD"){
	    currentPlayer.passD = parseInt(currentPlayer.passD, 10) + 1;
	}else if( PlayerService.getCurrentStat() === "tirC"){
	    currentPlayer.tirC = parseInt(currentPlayer.tirC, 10) + 1;
	}else if( PlayerService.getCurrentStat() === "ballP"){
	    currentPlayer.ballP = parseInt(currentPlayer.ballP, 10) + 1;
	}else{
	    alert('No current stat');
	}
    };
    
});

app.controller('MainCtrl', function (PlayerService){
    
    var main = this;
    main.newPlayer = { firstName: '', lastName: '', position: '', but: 0, passD: 0, tirC: 0, ballP: 0};
    main.currentPlayer = null; 
    main.players = PlayerService.getPlayers();
    

    main.setCurrentStat = function(stat){
	PlayerService.setCurrentStat(stat);

    };
    
    
    main.selectStat = function (currentPlayer) {
	PlayerService.selectStat(currentPlayer)
    };

    main.addPlayer = function() {
	PlayerService.addPlayer(angular.copy(main.newPlayer));
	console.log(main.players);
	main.newPlayer = { firstName: '', lastName: '', position: ''};
    };

    main.removePlayer = function(player) {
	PlayerService.removePlayer(player);
    };

    main.updatePlayer = function (player) {
	PlayerService.updatePlayer(player);
    };
});



app.service('PlayerService', function($firebaseArray, FIREBASE_URI){
    var service = this;
    var currentStat = '';
    var ref = new Firebase(FIREBASE_URI);
    var players = $firebaseArray(ref);

    service.setCurrentStat = function(stat){
	currentStat = {stat : stat };
	console.log(currentStat);
    };
    
    service.getCurrentStat = function(){ 
	console.log(currentStat);
	return currentStat; 

    };
    
    
    
    service.getPlayers = function () {
	return players;
    };

    service.addPlayer = function (player) {
	players.$add(player);
    };

    service.removePlayer = function (player) {
	players.$remove(player);
    };

    service.updatePlayer = function (player) {
	players.$save(player);
    };
});
